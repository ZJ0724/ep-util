<div style="padding: 0 30%;">
    <blockquote class="layui-elem-quote">
        <div class="title">
            配置
        </div>

        <div style="margin-top: 20px;">
            <table class="layui-table">
                <thead>
                <tr>
                    <th>参数名</th>
                    <th>参数值</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody id="configTable">
<!--                    <tr>-->
<!--                        <td>贤心</td>-->
<!--                        <td>汉族</td>-->
<!--                        <td class="center">-->
<!--                            <button type="button" class="layui-btn layui-btn-danger layui-btn-xs">修改</button>-->
<!--                        </td>-->
<!--                    </tr>-->
                </tbody>
            </table>
        </div>
    </blockquote>

    <script type="module">

        import Config from "../entity/Config.js";
        import configApi from "../api/configApi.js";
        import popupCommon from "../common/popupCommon.js";

        (function () {

            // 数据
            let data = {
                // 配置
                config: new Config()
            };

            // 元素
            let element = {
                // config表格
                configTable: document.getElementById("configTable")
            };

            // 方法
            let method = {
                // 加载数据
                loadData() {
                    configApi.get().then(function (responseData) {
                        data.config.setData(responseData);
                        console.log(data.config);

                        // 清除表格数据
                        element.configTable.innerHTML = "";

                        // 遍历数据
                        for (let key in data.config) {
                            if (data.config.hasOwnProperty(key)) {
                                // tr
                                let tr = document.createElement("tr");
                                // td1
                                let td1 = document.createElement("td");
                                // td2
                                let td2 = document.createElement("td");
                                // 操作列
                                let td3 = document.createElement("td");
                                // 按钮
                                let button = document.createElement("button");

                                element.configTable.appendChild(tr);
                                tr.appendChild(td1);
                                tr.appendChild(td2);
                                tr.appendChild(td3);
                                td1.innerHTML = key;
                                td2.innerHTML = data.config[key];
                                td3.setAttribute("class", "center");
                                td3.appendChild(button);
                                button.setAttribute("class", "layui-btn layui-btn-danger layui-btn-xs");
                                button.innerHTML = "编辑";
                                button.addEventListener("click", function () {
                                    method.setBox(key, data.config[key]);
                                });
                            }
                        }
                    });
                },

                // 编辑弹窗
                setBox(key, value) {
                    layui.use('layer', function(){
                        layer.open({
                            type: 1,
                            title: "",
                            area: "400px",
                            content: `<div style="padding: 20px;">
                                            <div>
                                                <input id="setBoxInput" type="text"class="layui-input" style="height: 25px;" />
                                            </div>
                                            <div style="margin-top: 10px;">
                                                <button id="setBoxButton" class="layui-btn" style="width: 100%;height: 30px;">确定</button>
                                            </div>
                                        </div>`
                        });

                        let setBoxInput = document.getElementById("setBoxInput");
                        let setBoxButton = document.getElementById("setBoxButton");

                        setBoxInput.value = value;
                        setBoxButton.addEventListener("click", function () {
                            data.config[key] = setBoxInput.value;
                            configApi.set(data.config).then(function () {
                                popupCommon.openMsg("修改成功");
                                method.loadData();
                            });
                        });
                    });
                }
            };

            method.loadData();

        })();

    </script>
</div>