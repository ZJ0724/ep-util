<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="/base.js"></script>
    <script type="module" src="/main.js"></script>
</head>
<body>
    <div id="main">
        <navigation></navigation>

        <div id="body">
            <panel text="version" :data="version"></panel>
            <panel style="margin-top: 20px;" text="time" :data="time"></panel>

            <div class="ep-panel" style="margin-top: 20px;">
                <div style="font-weight: bold;">
                    缓存文件管理
                </div>

                <div>
                    <!-- 无 -->
                    <div v-cloak v-if="cache.length === 0" style="margin-top: 10px;color: #0c0c0c73;">
                        无
                    </div>

                    <div v-cloak v-for="(item, key) in cache" style="display: flex;margin-top: 10px;" :key="key">
                        <div v-cloak style="width: 50%;">
                            {{item}}
                        </div>
                        <div v-cloak style="width: 50%;display: flex;flex-direction: row-reverse;">
                            <a @click="deleteCacheFile(item)" style="cursor: pointer;">删除</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

<script type="module">

    import systemServiceApi from "./api/service/systemServiceApi.js";

    new Vue({
        el: "#main",

        data: {
            version: null,

            time: null,

            cache: []
        },

        mounted() {
            let that = this;

            systemServiceApi.getVersion().then(function (version) {
                that.version = version;
            });

            systemServiceApi.getTime().then(function (time) {
                that.time = time;
            });

            that.getCache();
        },

        components: {
            panel: {
                template: `
                        <div v-cloak class="ep-panel" style="display: flex;">
                            <div style="font-weight: bold;width: 60px;">
                                {{text}}
                            </div>
                            <div>
                                {{data}}
                            </div>
                        </div>
                    `,

                props: ["text", "data"]
            }
        },

        methods: {
            deleteCacheFile(fileName) {
                let that = this;

                systemServiceApi.deleteCacheFile({fileName}).then(function () {
                    that.getCache();
                });
            },

            getCache() {
                let that = this;

                systemServiceApi.getCache().then(function (cache) {
                    that.cache = cache;
                });
            }
        }
    });

</script>